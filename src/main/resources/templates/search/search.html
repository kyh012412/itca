<!DOCTYPE html>
    <html xmlns:th="http://www.thymeleaf.org" lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!--=============== BOXICONS ===============-->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css">

        <!--=============== CSS ===============-->
        <link rel="stylesheet" href="/css/styles.css">
        <link rel="stylesheet" href="/css/search.css">

        <title>달곰 디저트 검색하기</title>
        <script>
            function fetchList(){
                let search_option = document.getElementById('search_option').value;
                let search_input = document.getElementById('search_input').value;
                let fetch_path = '/api/'+search_option+'/'+search_input;
                console.log(fetch_path);
                fetch(fetch_path)
                .then((result)=>{
                    let data = result.json();
                    if(data!=null){
                        document.getElementById('searched_list').innerHTML = '';
                    }
                    return data;
                })
                .then((data)=>{
                    console.log(data)
                    data.forEach(store => {
                        let store_div = document.createElement('div');
                        store_div.classList.add('store_div');

                        let images = store.images.map(
                            (image,idx) => {
                                if(idx==0 && image==null)
                                    return "이미지 없음 경로";
                                else if(image==null){
                                    return;
                                }
                            }
                        )
                        // let store_name = store.storeName;
                        // let store_path = store.storeLocation;

                        let images_div = document.createElement('div');
                        let store_name_div = document.createElement('div');
                        let store_path_div = document.createElement('div');

                        images_div.classList.add('images_div');
                        store_name_div.classList.add('store_name_div');
                        store_path_div.classList.add('store_path_div');

                        let images_img = document.createElement('img');
                        images_img.setAttribute('src', images[0]);
                        images_img.setAttribute('alt', '이미지 경로 유실');
                        images_div.appendChild(images_img);

                        store_name_div.innerText=store.storeName;
                        store_path_div.innerText=store.storeLocation;

                        store_div.appendChild(images_div);
                        store_div.appendChild(store_name_div);
                        store_div.appendChild(store_path_div);

                        let search_list = document.getElementById('searched_list')
                        search_list.appendChild(store_div);
                    });
                    document.getElementById('default_list').style.display = "none";
                })
                .catch((error)=>{
                    console.log("조회된 데이터가 없습니다.");
                    let nothing_searched_div = document.createElement('div');

                    nothing_searched_div.classList.add('nothing_searched_div');
                    nothing_searched_div.innerHTML = "조회된 데이터가 없습니다."; 

                    document.getElementById('searched_list').appendChild(nothing_searched_div);
                });
            }
        </script>

    </head>
    <body>
        <!--=============== HEADER ===============-->
        <header class="header" id="header">
            <nav class="nav container">
                <a href="#" class="nav__logo">달곰디저트</a>

                <div class="nav__menu" id="nav-menu">
                    <ul class="nav__list">
                        <li class="nav__item">
                            <a href="/home" class="nav__link active-link">
                                <i class='bx bx-home-alt nav__icon'></i>
                                <span class="nav__name">홈</span>
                            </a>
                        </li>
                        <li class="nav__item">
                            <a href="/search" class="nav__link">
                                <i class='bx bx-message-square-detail nav__icon'></i>
                                <span class="nav__name">검색</span>
                            </a>
                        </li>
                        <li class="nav__item">
                            <a href="/reservation" class="nav__link">
                                <i class='bx bx-book-alt nav__icon'></i>
                                <span class="nav__name">예약</span>
                            </a>
                        </li>

                        <li class="nav__item">
                            <a href="/mypage" class="nav__link">
                                <i class='bx bx-user nav__icon'></i>
                                <span class="nav__name">마이페이지</span>
                            </a>
                        </li>
                    </ul>
                </div>

                <img src="/img/perfil.png" alt="" class="nav__img">
            </nav>
        </header>

        <main>
            <!--=============== CONTACTME ===============-->
            <section class="container section section__height" id="contactme">
                <h2 class="section__title">검색화면</h2>
                <label for="search_option">검색하기</label>
                <div class="search_module">
                    <select id="search_option" name="search_option">
                        <option value="search">상호명</option>
                        <option value="location">지역</option>
                    </select>
                    <input type="text" id="search_input" oninput="fetchList()">
                </div>
                <!-- <button id="search_btn" value="검색2">검색</button> -->
                <div>
                    <div id="category_list">
                        <div class="col">
                            <div class="recommend_module">
                                <div class="row" id="recommend_list"></div>
                            </div>
                            <div class="hashtag_module">
                                <div class="row" id="hashtag_list"></div>
                            </div>
                        </div>
                    </div>

                    <div id="searched_list">
                        <th:block th:if="${list}">
                            th:block list exist
                        </th:block>
                    </div>
                    <br/>
                    <div id="default_list">
                        <th:block th:unless="${list}">
                            th:block list non-exist
                        </th:block>
                    </div>
                </div>
            </section>
        </main>
        

        <!--=============== MAIN JS ===============-->
        <script src="/js/main.js"></script>
    </body>
</html>